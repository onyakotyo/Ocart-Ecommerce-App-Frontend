{"ast":null,"code":"import _regeneratorRuntime from\"/Users/onesmusnyakotyo/ocart/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/onesmusnyakotyo/ocart/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/onesmusnyakotyo/ocart/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{useStripe}from'@stripe/react-stripe-js';import{useSelector}from'react-redux';import{fetchFromAPI}from'./StripeHelper';import{Button,Form}from'react-bootstrap';import Loader from'../../components/Loader';import Message from'../../components/Message';import FormContainer from'../../components/FormContainer';import CheckoutSteps from'../../components/CheckoutSteps';//import Stripe from 'stripe'\n//import { LinkContainer } from 'react-router-bootstrap'\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var StripeCheckout=function StripeCheckout(){var userLogin=useSelector(function(state){return state.userLogin;});var loading=userLogin.loading,error=userLogin.error,userInfo=userLogin.userInfo;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var cart=useSelector(function(state){return state.cart;});var cartItems=cart.cartItems;console.log('CART STRIPE',cartItems);var stripe=useStripe();var checkoutHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var line_items,response,sessionId,_yield$stripe$redirec,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();line_items=cartItems.map(function(item){return{quantity:item.qty,price_data:{currency:'usd',unit_amount:item.price*100,// amount is in cents\nproduct_data:{name:item.name,description:item.description,images:[item.image]//images:  '/Users/onesmusnyakotyo/ocart/frontend/public/images/airpods.jpg'\n}}};});console.log('LINEITEMS',line_items);_context.next=5;return fetchFromAPI('create-checkout-session',{body:{line_items:line_items,customer_email:email}});case 5:response=_context.sent;console.log('RESPONSE',response);sessionId=response.sessionId;console.log('SESSIONID',sessionId);_context.next=11;return stripe.redirectToCheckout({sessionId:sessionId});case 11:_yield$stripe$redirec=_context.sent;error=_yield$stripe$redirec.error;if(error){console.log(error);}case 14:case\"end\":return _context.stop();}}},_callee);}));return function checkoutHandler(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(FormContainer,{children:[/*#__PURE__*/_jsx(CheckoutSteps,{step1:true,step2:true,step3:true,step4:true}),error&&/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:error}),loading&&/*#__PURE__*/_jsx(Loader,{}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-center py-3 m-3\",children:\"Please Checkout Below\"}),/*#__PURE__*/_jsx(Form,{onSubmit:checkoutHandler,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"text-center\",children:[/*#__PURE__*/_jsx(Form.Control,{type:\"email\",placeholder:\"Email\",value:email,required:true,onChange:function onChange(e){return setEmail(e.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",children:\"Checkout\"})]})})]})});};export default StripeCheckout;","map":{"version":3,"sources":["/Users/onesmusnyakotyo/ocart/frontend/src/screens/CheckoutScreen/StripeCheckout.js"],"names":["React","useState","useStripe","useSelector","fetchFromAPI","Button","Form","Loader","Message","FormContainer","CheckoutSteps","StripeCheckout","userLogin","state","loading","error","userInfo","email","setEmail","cart","cartItems","console","log","stripe","checkoutHandler","e","preventDefault","line_items","map","item","quantity","qty","price_data","currency","unit_amount","price","product_data","name","description","images","image","body","customer_email","response","sessionId","redirectToCheckout","target","value"],"mappings":"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","sourcesContent":["import React, {useState} from 'react'\nimport {  useStripe } from '@stripe/react-stripe-js'\nimport { useSelector } from 'react-redux'\nimport { fetchFromAPI }  from './StripeHelper'\nimport {Button, Form } from 'react-bootstrap'\nimport Loader from '../../components/Loader'\nimport Message from '../../components/Message'\nimport FormContainer from '../../components/FormContainer'\nimport CheckoutSteps from '../../components/CheckoutSteps'\n//import Stripe from 'stripe'\n//import { LinkContainer } from 'react-router-bootstrap'\n\n\nconst StripeCheckout = () => {\n\n  \n\n    const userLogin = useSelector(state => state.userLogin)\n\n    const { loading, error, userInfo } = userLogin\n\n\n   \n    const [email, setEmail] = useState('')\n\n       \n        const cart = useSelector((state) => state.cart)\n         const { cartItems } = cart\n\n         console.log('CART STRIPE', cartItems)\n\n        const stripe = useStripe()\n\n        const checkoutHandler  = async (e) => {\n            e.preventDefault();\n\n            const line_items = cartItems.map(item => {\n            return {\n                quantity: item.qty,\n                price_data: {\n                currency: 'usd',\n                unit_amount: item.price * 100, // amount is in cents\n                product_data: {\n                    name: item.name,\n                    description: item.description,\n                    images: [item.image]\n                    //images:  '/Users/onesmusnyakotyo/ocart/frontend/public/images/airpods.jpg'\n                    \n                },\n                \n                }\n            }\n            });\n\n\n            console.log('LINEITEMS', line_items )\n       \n\n        const response = await fetchFromAPI('create-checkout-session', {\n             body: { line_items, customer_email: email },\n            });\n\n            console.log('RESPONSE', response )\n\n\n        const { sessionId } = response;\n\n           console.log('SESSIONID', sessionId )\n\n        const { error } = await stripe.redirectToCheckout({\n             sessionId\n            });\n\n         if(error) {\n            console.log(error);\n            }\n\n\n         \n        }\n\n    return (\n        <>\n            <FormContainer>\n\n               <CheckoutSteps step1 step2 step3 step4 />\n\n               {error && <Message variant='danger'>{error}</Message>}\n               {loading && <Loader />}\n                   \n                <h4 className='text-center py-3 m-3'>Please Checkout Below</h4>\n                 \n                     \n\n                <Form  onSubmit={checkoutHandler}> \n                <Form.Group className='text-center'>\n  \n                    <Form.Control \n                        type=\"email\" \n                        placeholder=\"Email\"  \n                        value={email}\n                        required\n                        onChange={(e) => setEmail(e.target.value)}\n                        />\n                    <br />\n    \n                    <Button type='submit' variant='primary'>\n                            Checkout\n                    </Button>\n  \n                </Form.Group>\n                </Form>  \n            </FormContainer>\n            </>\n    )\n}\n\nexport default StripeCheckout\n\n\n"]},"metadata":{},"sourceType":"module"}